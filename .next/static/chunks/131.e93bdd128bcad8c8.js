"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[131],{4131:(e,t,a)=>{a.r(t),a.d(t,{PaymentModal:()=>f});var s,l=a(5155),i=a(2115),n=a(4088),r=a(8633),c=a(7506),o=a(2236),d=a(767),m=a(3239),x=a(4505),p=a(7135);let b=(0,c.c)(null!==(s=(void 0).VITE_STRIPE_PUBLISHABLE_KEY)&&void 0!==s?s:""),u={style:{base:{fontFamily:"'Jost', sans-serif",fontSize:"14px",color:"#000000","::placeholder":{color:"rgba(0,0,0,0.4)"}},invalid:{color:"#B44A3D"}}};function h(e){let{reservationId:t,reservationData:a,onSuccess:s,onClose:r}=e,c=(0,o.t2)(),b=(0,o.HH)(),[h,f]=(0,i.useState)(null),[j,y]=(0,i.useState)(!1),[k,N]=(0,i.useState)(null),[v,g]=(0,i.useState)(null),[w,C]=(0,i.useState)(!1),S=(p.aM.depositAmountCents/100).toFixed(2),P=p.aM.depositCurrency.toUpperCase();(0,i.useEffect)(()=>{let e=!1;return async function(){try{let s=await fetch("/api/payment/create-intent",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({reservationId:t,amount:p.aM.depositAmountCents,currency:p.aM.depositCurrency})}),l=await s.json();if(!e){if(s.ok&&l.clientSecret)f(l.clientSecret);else{var a;N(null!==(a=l.error)&&void 0!==a?a:"Could not initialize payment.")}}}catch(t){e||N("Unable to reach the payment server.")}}(),()=>{e=!0}},[t]);let z=async e=>{if(e.preventDefault(),!c||!b||!h)return;y(!0),g(null);let t=b.getElement(o.hA);if(!t)return;let{error:s,paymentIntent:l}=await c.confirmCardPayment(h,{payment_method:{card:t,billing_details:{name:"".concat(a.firstName," ").concat(a.lastName),email:a.email}}});if(s){var i;g(null!==(i=s.message)&&void 0!==i?i:"Payment failed. Please try again."),y(!1)}else(null==l?void 0:l.status)==="succeeded"&&(C(!0),y(!1))};return(0,l.jsxs)("div",{className:"px-6 sm:px-12 md:px-16 lg:px-24 py-16 sm:py-20",children:[(0,l.jsx)("button",{onClick:r,className:"mb-8 p-2 -ml-2 text-black/60 hover:text-black transition-colors",children:(0,l.jsx)(d.A,{size:20})}),(0,l.jsx)("p",{className:"text-black text-[10px] tracking-[0.35em] uppercase mb-3 font-jost",children:"reservation deposit"}),(0,l.jsx)("h2",{className:"text-black mb-4 leading-tight font-cormorant italic",style:{fontSize:"clamp(1.8rem, 8vw, 3rem)"},children:"secure your table"}),(0,l.jsxs)("div",{className:"border-t border-black/10 pt-5 mb-8 space-y-3 sm:space-y-2 text-sm",children:[(0,l.jsxs)("div",{className:"flex justify-between gap-4",children:[(0,l.jsx)("span",{className:"text-black/60 flex-shrink-0",children:"Guest"}),(0,l.jsxs)("span",{className:"text-black text-right truncate",children:[a.firstName," ",a.lastName]})]}),(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)("span",{className:"text-black/60",children:"Date"}),(0,l.jsx)("span",{className:"text-black",children:a.date})]}),(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)("span",{className:"text-black/60",children:"Time"}),(0,l.jsx)("span",{className:"text-black",children:a.time})]}),(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)("span",{className:"text-black/60",children:"Party size"}),(0,l.jsx)("span",{className:"text-black",children:a.guests})]}),(0,l.jsxs)("div",{className:"flex justify-between border-t border-black/10 pt-3 mt-3",children:[(0,l.jsx)("span",{className:"text-black/60",children:"Deposit"}),(0,l.jsxs)("span",{className:"text-black font-medium",children:["$",S," ",P]})]})]}),w?(0,l.jsxs)(n.P.div,{initial:{opacity:0,y:16},animate:{opacity:1,y:0},className:"flex flex-col gap-4",children:[(0,l.jsx)(m.A,{size:28,className:"text-black"}),(0,l.jsxs)("p",{className:"text-black",style:{fontFamily:"'Cormorant Garamond', serif",fontSize:"1.5rem",fontStyle:"italic"},children:["Payment confirmed, ",a.firstName,"."]}),(0,l.jsxs)("p",{className:"text-black text-sm",children:["Your deposit of $",S," has been received. A confirmation has been sent to ",a.email,"."]}),(0,l.jsx)("button",{onClick:s,className:"self-start text-xs tracking-[0.2em] uppercase border-b border-black/40 text-black mt-4 hover:border-black transition-colors",children:"done"})]}):k?(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsx)("p",{className:"text-red-600 text-sm",children:k}),(0,l.jsx)("button",{onClick:r,className:"text-xs tracking-[0.2em] uppercase border-b border-black/40 text-black hover:border-black transition-colors",children:"go back"})]}):h?(0,l.jsxs)("form",{onSubmit:z,className:"space-y-6",children:[v&&(0,l.jsx)(n.P.p,{initial:{opacity:0,y:-4},animate:{opacity:1,y:0},className:"text-red-600 text-sm",children:v}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"text-black text-[10px] tracking-[0.25em] uppercase block mb-3",children:"Card details"}),(0,l.jsx)("div",{className:"border-b border-black/25 focus-within:border-black pb-2.5 transition-colors duration-300",children:(0,l.jsx)(o.hA,{options:u})})]}),(0,l.jsxs)("button",{type:"submit",disabled:j||!c,className:"group flex items-center gap-3 text-black text-xs tracking-[0.2em] uppercase mt-4 border-b border-black/40 pb-0.5 hover:border-black transition-all duration-300 disabled:opacity-50",children:[j?"processing...":"pay $".concat(S," deposit"),!j&&(0,l.jsx)("span",{className:"transform group-hover:translate-x-1 transition-transform duration-300 text-base",children:"â†’"})]}),(0,l.jsx)("p",{className:"text-black/40 text-[10px] mt-4 leading-relaxed",children:"Your deposit will be applied toward your final bill. Cancellations must be made 24 hours in advance for a full refund."})]}):(0,l.jsxs)("div",{className:"flex items-center gap-3 text-black text-sm",children:[(0,l.jsx)(x.A,{size:16,className:"animate-spin"}),"Preparing payment..."]})]})}function f(e){let{open:t,onClose:a,reservationId:s,reservationData:i,onSuccess:c}=e;return(0,l.jsx)(r.N,{children:t&&s&&i&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 bg-black/30 backdrop-blur-sm",onClick:a}),(0,l.jsx)(n.P.div,{initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},transition:{duration:.55,ease:[.22,1,.36,1]},className:"fixed right-0 top-0 bottom-0 z-50 bg-[#F2EDE7] w-full max-w-xl overflow-y-auto shadow-2xl",children:(0,l.jsx)(o.S8,{stripe:b,children:(0,l.jsx)(h,{reservationId:s,reservationData:i,onSuccess:c,onClose:a})})})]})})}}}]);